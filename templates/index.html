<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>IPアドレス認証</title>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.2/dist/confetti.browser.min.js"
    ></script>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body>
    <main class="container" id="auth-screen">
      <div class="illustration-wrapper" id="icon-wrapper">
        </div>

      <h1 class="title" id="auth-title">IPアドレス認証が必要です</h1>
      <div class="divider" aria-hidden="true"></div>

      <div id="dynamic-flow">
        <div class="auth-step">
          <div class="step-title">
            1. 認証コードを発行
            <span id="id-status">...</span>
          </div>
          <div class="step-content">
            <span id="generated-id" data-code="">コード発行中...</span>
            <button class="step-button" id="copy-id-button" disabled>
              📋 コードをコピー
            </button>
          </div>
        </div>

        <div class="auth-step">
          <div class="step-title">
            2. Discordで承認
            <span id="auth-status">未完了</span>
          </div>
          <p class="message-small">
            [こちら](https://discord.gg/ZuEvp5PKWA)のDiscordチャンネルで、<br />
            **/認証コード承認** コマンドを使用してください。
          </p>
        </div>
      </div>

      <p class="message" id="auth-message">状態を確認しています...</p>
    </main>

    <div id="authenticated-content"></div>

    <footer class="page-footer">
      <a
        href="https://discord.gg/ZuEvp5PKWA"
        class="support-link"
        target="_blank"
        rel="noopener noreferrer"
      >
        (サポートサーバー)
      </a>
    </footer>

    <div class="theme-switch-wrapper" aria-label="テーマ切り替え">
      <label class="theme-switch">
        <input type="checkbox" id="checkbox" aria-label="ダークモード" />
        <div class="slider">
          <div class="slider-icon">
            <svg
              class="sun-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                d="M12 3a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1zm7.07 3.93a1 1 0 0 1 0 1.414l-.707.707a1 1 0 1 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0zM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8zm-8.07-1.07a1 1 0 0 1 1.414 0l.707.707A1 1 0 1 1 4.636 9.05l-.707-.707a1 1 0 0 1 0-1.414zM4 12a1 1 0 0 1 1-1h1a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1zm.636 5.95a1 1 0 0 1 0-1.414l.707-.707a1 1 0 0 1 1.414 1.414l-.707.707a1 1 0 0 1 0 1.414zM12 19a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1zm7.07-1.07a1 1 0 0 1-1.414 0l-.707-.707a1 1 0 0 1 1.414-1.414l.707.707a1 1 0 0 1 0 1.414zM20 12a1 1 0 0 1-1 1h-1a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1z"
              />
            </svg>
            <svg
              class="moon-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313-12.454z"
              />
            </svg>
          </div>
        </div>
      </label>
    </div>

    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" aria-hidden="true">
      <defs>
        <linearGradient id="grad-success-def" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="var(--accent-color)" />
          <stop offset="100%" stop-color="var(--accent-color-2)" />
        </linearGradient>
        <path id="success-circle-path" d="M26 2c13.255 0 24 10.745 24 24s-10.745 24-24 24S2 39.255 2 26 12.745 2 26 2z"/>
        <path id="success-check-path" d="M14.1 27.2l7.1 7.2 16.7-16.8" />

        <linearGradient id="grad-error-def" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="var(--error-color)" />
          <stop offset="100%" stop-color="var(--error-color-2)" />
        </linearGradient>
        <path id="error-circle-path" d="M26 2c13.255 0 24 10.745 24 24s-10.745 24-24 24S2 39.255 2 26 12.745 2 26 2z"/>
        <path id="error-cross-path" d="M16 16 36 36 M36 16 16 36" />
      </defs>
    </svg>

    <script>
      const serverUrl = "";
      let checkInterval;

      // ===================================
      // 認証コード生成・コピーロジック
      // ===================================
      async function generateAuthId() {
        const idSpan = document.getElementById("generated-id");
        const copyButton = document.getElementById("copy-id-button");

        idSpan.textContent = "コード発行中...";
        copyButton.disabled = true;
        document.getElementById("id-status").textContent = "...";

        try {
          const response = await fetch(serverUrl + "/generate_id");
          const data = await response.json();

          if (data.status === "authenticated") {
            // すでに認証済みの場合
            checkAuthentication(true);
            return;
          }

          if (data.auth_id) {
            idSpan.textContent = data.auth_id;
            idSpan.dataset.code = data.auth_id;
            document.getElementById("id-status").textContent = "✅ 発行済";
            copyButton.disabled = false;
          } else {
            idSpan.textContent = "発行失敗";
            document.getElementById("id-status").textContent = "❌ 失敗";
          }
        } catch (error) {
          idSpan.textContent = "サーバーエラー";
          document.getElementById("id-status").textContent = "❌ 失敗";
        }
      }

      function copyIdToClipboard() {
        const id = document.getElementById("generated-id").dataset.code;
        if (id) {
          navigator.clipboard
            .writeText(id)
            .then(() => {
              const button = document.getElementById("copy-id-button");
              const originalText = button.textContent;
              button.textContent = "✅ コピー完了！";
              setTimeout(() => {
                button.textContent = originalText;
              }, 1500);
            })
            .catch((err) => {
              alert("コピーに失敗しました: " + err);
            });
        }
      }
      document
        .getElementById("copy-id-button")
        .addEventListener("click", copyIdToClipboard);

      // ===================================
      // 認証チェックとコンテンツ取得ロジック
      // ===================================
      async function checkAuthentication(forceContentLoad = false) {
        const authScreen = document.getElementById("auth-screen");
        const authContent = document.getElementById("authenticated-content");
        const authTitle = document.getElementById("auth-title");
        const authMessage = document.getElementById("auth-message");
        const iconWrapper = document.getElementById("icon-wrapper");

        if (!forceContentLoad) {
          authMessage.innerHTML = '状態を確認中...';
        }

        try {
          const authResponse = await fetch(serverUrl + "/check_auth");
          const authData = await authResponse.json();

          if (authData.authenticated) {
            // --- 認証成功フロー ---
            clearInterval(checkInterval);

            authTitle.textContent = "🎉 認証成功！";
            authMessage.textContent = "認証後のコンテンツを読み込みます...";
            document.getElementById("dynamic-flow").style.display = "none";
            iconWrapper.style.opacity = 1;

            // 成功アニメーションアイコンを挿入
            iconWrapper.innerHTML = `
                <svg class="success-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" aria-hidden="true">
                    <defs>
                        <linearGradient id="grad-success" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="var(--accent-color)" />
                            <stop offset="100%" stop-color="var(--accent-color-2)" />
                        </linearGradient>
                    </defs>
                    <circle class="success-icon__circle" cx="26" cy="26" r="24" fill="none"/>
                    <path class="success-icon__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            `;
            
            // 紙吹雪を起動
            confetti({
                particleCount: 150,
                spread: 80,
                origin: { y: 0.6 },
                colors: ["#00f5ff", "#0d6efd", "#f8f9fa", "#6c757d"],
            });


            // アニメーション完了を待つ (CSSアニメーション時間に合わせて調整)
            await new Promise((resolve) => setTimeout(resolve, 1500));

            // コンテンツをロード
            const contentResponse = await fetch(serverUrl + "/authenticated_content");

            if (contentResponse.ok) {
              const contentHtml = await contentResponse.text();

              authScreen.style.display = "none";
              authContent.innerHTML = contentHtml;
              authContent.style.display = "block";
            } else {
              authTitle.textContent = "❌ コンテンツ読み込み失敗";
              authMessage.textContent = `エラーコード: ${contentResponse.status}。サーバーのHTMLファイルを確認してください。`;
              // 失敗アイコンに切り替え (アニメーションなし)
              iconWrapper.innerHTML = `
                <svg class="error-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" aria-hidden="true">
                    <defs>
                        <linearGradient id="grad-error" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="var(--error-color)" />
                            <stop offset="100%" stop-color="var(--error-color-2)" />
                        </linearGradient>
                    </defs>
                    <circle class="error-icon__circle" cx="26" cy="26" r="24" fill="none" style="stroke-dashoffset:0;"/>
                    <path class="error-icon__cross" fill="none" d="M16 16 36 36 M36 16 16 36" style="stroke-dashoffset:0; stroke:url(#grad-error)"/>
                </svg>
              `;
            }
          } else {
            // --- 未認証フロー ---
            authScreen.style.display = "block";
            authContent.style.display = "none";
            
            authTitle.textContent = "IPアドレス認証が必要です";
            authMessage.textContent = "Discordでの承認をお待ちください。";
            document.getElementById("dynamic-flow").style.display = "block";
            iconWrapper.innerHTML = '';
            iconWrapper.style.opacity = 0;


            // 認証コードがまだ生成されていない場合、生成する
            if (
              !document.getElementById("generated-id").dataset.code ||
              document.getElementById("generated-id").dataset.code === "authenticated"
            ) {
              generateAuthId();
            }
          }
        } catch (error) {
          authTitle.textContent = "🚨 サーバーエラー";
          authMessage.textContent = "サーバーに接続できません。ネットワークまたはサーバーの状態を確認してください。";
          // エラーアニメーションはここでは起動せず、静止画として表示
          iconWrapper.innerHTML = `
                <svg class="error-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" aria-hidden="true">
                    <defs>
                        <linearGradient id="grad-error" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="var(--error-color)" />
                            <stop offset="100%" stop-color="var(--error-color-2)" />
                        </linearGradient>
                    </defs>
                    <circle class="error-icon__circle" cx="26" cy="26" r="24" fill="none" style="stroke-dashoffset:0;"/>
                    <path class="error-icon__cross" fill="none" d="M16 16 36 36 M36 16 16 36" style="stroke-dashoffset:0; stroke:url(#grad-error)"/>
                </svg>
            `;
            iconWrapper.style.opacity = 1;
        }
      }

      // 初回実行と3秒ごとの認証状態チェック
      checkAuthentication();
      checkInterval = setInterval(checkAuthentication, 3000);

      // ===================================
      // テーママネージャー (変更なし)
      // ===================================
      class ThemeManager {
        constructor() {
          this.checkbox = document.querySelector("#checkbox");
          this.initializeTheme();
          this.setupEventListeners();
        }
        initializeTheme() {
          const prefersDark = window.matchMedia("(prefers-color-scheme: dark)");
          const savedTheme = localStorage.getItem("theme");
          if (savedTheme) {
            document.documentElement.setAttribute("data-theme", savedTheme);
            this.checkbox.checked = savedTheme === "dark";
          } else {
            const theme = prefersDark.matches ? "dark" : "light";
            document.documentElement.setAttribute("data-theme", theme);
            this.checkbox.checked = prefersDark.matches;
          }
        }
        setupEventListeners() {
          this.checkbox.addEventListener("change", () => {
            const theme = this.checkbox.checked ? "dark" : "light";
            document.documentElement.setAttribute("data-theme", theme);
            localStorage.setItem("theme", theme);
          });
          window
            .matchMedia("(prefers-color-scheme: dark)")
            .addEventListener("change", (e) => {
              if (!localStorage.getItem("theme")) {
                const theme = e.matches ? "dark" : "light";
                document.documentElement.setAttribute("data-theme", theme);
                this.checkbox.checked = e.matches;
              }
            });
        }
      }
      new ThemeManager();
    </script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;800&display=swap");

      /* ====== Theme Tokens ====== */
      :root {
        --bg-color: #f6f7fb;
        --bg-aurora-1: #b8d7ff;
        --bg-aurora-2: #ffe1f0;
        --bg-aurora-3: #d9fff1;

        --card-bg: rgba(255, 255, 255, 0.65);
        --card-backdrop: blur(14px);
        --card-border: rgba(255, 255, 255, 0.6);

        --primary-text: #1b1f24;
        --secondary-text: #5a6572;

        --accent-color: #0d6efd;
        --accent-color-2: #00bcd4;
        --accent-color-light: rgba(13, 110, 253, 0.15);

        --error-color: #dc3545;
        --error-color-2: #ff6b7a;
        --error-color-light: rgba(220, 53, 69, 0.12);
        
        --button-bg: #0d6efd; /* New */
        --button-hover-bg: #0b5ed7; /* New */

        --border-color: rgba(27, 31, 36, 0.06);
        --shadow-color: rgba(16, 24, 40, 0.08);

        --support-bg: rgba(240, 240, 240, 0.85);
        --support-text: #333;
        --support-shadow: rgba(0,0,0,0.12);
        --support-shadow-hover: rgba(0,0,0,0.18);

        --switch-bg: #e9e9e9;
        --switch-slider: #ffffff;
        --icon-fill: #333333;

        --transition-time: 0.45s;
        --radius: 24px;
        --outline-radius: 28px;
      }

      :root[data-theme="dark"] {
        --bg-color: #0e1320;
        --bg-aurora-1: #2643a7;
        --bg-aurora-2: #7a2e7b;
        --bg-aurora-3: #0b6e6b;

        --card-bg: rgba(26, 32, 56, 0.6);
        --card-backdrop: blur(16px);
        --card-border: rgba(255, 255, 255, 0.12);

        --primary-text: #f4f6fb;
        --secondary-text: #c0c7d2;

        --accent-color: #00f5ff;
        --accent-color-2: #5a8bff;
        --accent-color-light: rgba(0, 245, 255, 0.14);

        --error-color: #ff7b88;
        --error-color-2: #ffb3bd;
        --error-color-light: rgba(255, 123, 136, 0.12);

        --button-bg: #00f5ff; /* New */
        --button-hover-bg: #00b0ff; /* New */

        --border-color: rgba(255, 255, 255, 0.06);
        --shadow-color: rgba(0, 0, 0, 0.25);
        
        --support-bg: rgba(40, 40, 50, 0.8);
        --support-text: #e1e1ff;
        --support-shadow: rgba(0,0,0,0.4);
        --support-shadow-hover: rgba(0,0,0,0.55);

        --switch-bg: #34323d;
        --switch-slider: #444452;
        --icon-fill: #e1e1ff;
      }

      /* ====== Base ====== */
      * { box-sizing: border-box; }
      html { font-family: "Noto Sans JP", system-ui, -apple-system, "Segoe UI", sans-serif; }
      body {
        margin: 0;
        min-height: 100vh;
        color: var(--primary-text);
        background: var(--bg-color);
        display: grid;
        place-items: center;
        overflow-x: hidden;
        transition: background-color var(--transition-time) ease;
      }
      #authenticated-content { 
          display: none; 
          width: 100%; 
          height: 100vh;
          position: fixed; 
          top: 0; left: 0; 
          z-index: 100;
          background-color: var(--bg-color);
      }


      /* やわらかいオーロラ背景 (変更なし) */
      body::before,
      body::after {
        content: "";
        position: fixed;
        inset: -20vmax -10vmax auto -10vmax;
        height: 60vmax;
        filter: blur(60px);
        z-index: -1;
        opacity: 0.55;
        pointer-events: none;
        background:
          radial-gradient(30vmax 30vmax at 20% 30%, var(--bg-aurora-1), transparent 60%),
          radial-gradient(28vmax 28vmax at 80% 20%, var(--bg-aurora-2), transparent 60%),
          radial-gradient(32vmax 32vmax at 70% 80%, var(--bg-aurora-3), transparent 60%);
        animation: auroraMove 18s ease-in-out infinite;
      }
      body::after {
        inset: auto -10vmax -20vmax -10vmax;
        transform: scaleX(-1);
        animation-direction: reverse;
        opacity: 0.45;
      }
      @keyframes auroraMove {
        0%,100% { transform: translateY(0) translateX(0); }
        50%     { transform: translateY(-2vmax) translateX(1vmax); }
      }

      /* ====== Card (変更なし) ====== */
      .container {
        width: 100%;
        max-width: 520px;
        margin: 24px;
        padding: 48px 40px;
        background: var(--card-bg);
        backdrop-filter: var(--card-backdrop);
        -webkit-backdrop-filter: var(--card-backdrop);
        border-radius: var(--radius);
        position: relative;
        text-align: center;
        box-shadow:
          0 20px 60px var(--shadow-color),
          0 1px 0 var(--border-color) inset;
        transition: transform .4s ease, box-shadow .4s ease;
        animation: popIn .6s cubic-bezier(.175,.885,.32,1.275) forwards;
        opacity: 0;
      }
      .container::before {
        content: "";
        position: absolute;
        inset: -2px;
        border-radius: calc(var(--radius) + 6px);
        background: conic-gradient(from 180deg,
          rgba(255,255,255,.4),
          rgba(255,255,255,.12),
          rgba(255,255,255,.4));
        filter: blur(6px);
        opacity: .55;
        z-index: -1;
      }
      .container::after {
        content: "";
        position: absolute;
        inset: 10px;
        border-radius: calc(var(--radius) - 8px);
        box-shadow: inset 0 0 0 1px var(--card-border);
        pointer-events: none;
        opacity: .5;
      }

      .illustration-wrapper {
        margin-bottom: 1.3rem;
        animation: slideIn .8s .2s ease-out forwards;
        opacity: 0;
        min-height: 96px; /* レイアウト崩れ防止 */
      }

      /* ====== Icons (変更なし) ====== */
      .success-icon, .error-icon {
        width: 96px;
        height: 96px;
        display: block;
        margin: 0 auto;
        filter: drop-shadow(0 8px 18px rgba(0,0,0,.18));
      }
      .success-icon__circle,
      .error-icon__circle {
        stroke-dasharray: 151;
        stroke-dashoffset: 151;
        stroke-width: 4;
        stroke-linecap: round;
        animation: drawCircle .8s .5s ease-out forwards;
        fill: none;
      }
      .success-icon__check,
      .error-icon__cross {
        stroke-dasharray: 60;
        stroke-dashoffset: 60;
        stroke-linecap: round;
        stroke-linejoin: round;
        stroke-width: 5;
        fill: none;
      }
      .success-icon__check {
        stroke: url(#grad-success);
        animation: drawCheck .6s 1s ease-out forwards;
      }
      .success-icon__circle {
        stroke: var(--accent-color-light);
      }
      .error-icon__cross {
        stroke: url(#grad-error);
        animation: drawCross .5s 1s ease-out forwards;
      }
      .error-icon__circle {
        stroke: var(--error-color-light);
      }

      /* ====== Text / Divider (変更なし) ====== */
      .title {
        color: var(--primary-text);
        font-size: clamp(1.6rem, 4.5vw, 2rem);
        font-weight: 800;
        letter-spacing: .02em;
        margin: 0 0 .6rem;
        animation: fadeIn .8s .35s ease-out forwards;
        opacity: 0;
      }
      .divider {
        height: 1px;
        width: min(80%, 360px);
        margin: 10px auto 18px;
        background: linear-gradient(90deg,
          transparent,
          rgba(255,255,255,.5),
          transparent);
        opacity: .5;
      }
      .message {
        color: var(--secondary-text);
        font-size: clamp(1rem, 3.5vw, 1.1rem);
        line-height: 1.7;
        margin: 0;
        animation: fadeIn .8s .5s ease-out forwards;
        opacity: 1; /* JSで操作するため初期値1 */
      }

      /* ====== New Step Styles (統合のための追加CSS) ====== */
      #dynamic-flow {
          text-align: left;
          margin-top: 25px;
          animation: fadeIn .8s .7s ease-out forwards;
          opacity: 1;
      }
      .auth-step {
          background: rgba(0, 0, 0, 0.05);
          padding: 16px;
          border-radius: 12px;
          margin-bottom: 15px;
          border: 1px solid var(--border-color);
      }
      .step-title {
          font-weight: 700;
          font-size: 1.1rem;
          color: var(--primary-text);
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
      }
      .step-content {
          padding-top: 8px;
      }
      .message-small {
        color: var(--secondary-text);
        font-size: 0.95rem;
        line-height: 1.5;
        margin: 0;
      }
      #generated-id {
          font-family: 'Consolas', monospace;
          font-size: 1.25rem;
          font-weight: bold;
          color: var(--accent-color);
          background: rgba(0, 0, 0, 0.2);
          display: block;
          padding: 10px;
          border-radius: 8px;
          text-align: center;
          letter-spacing: 2px;
          margin-bottom: 12px;
      }
      .step-button {
          background-color: var(--button-bg);
          color: #fff;
          border: none;
          border-radius: 8px;
          padding: 10px 18px;
          cursor: pointer;
          font-weight: 600;
          font-size: 1rem;
          transition: background-color 0.2s, transform 0.1s;
          width: 100%;
      }
      .step-button:hover:not(:disabled) {
          background-color: var(--button-hover-bg);
          transform: translateY(-1px);
      }
      .step-button:disabled { background-color: #6c757d; cursor: not-allowed; opacity: 0.7; }
      
      /* ====== Footer / Theme Switch (統合のための調整) ====== */
      .page-footer {
        position: fixed;
        bottom: 22px;
        left: 50%;
        transform: translateX(-50%);
        color: var(--secondary-text);
        font-size: .84rem;
        opacity: .75;
        user-select: none;
      }
      .support-link {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 18px;
        font-weight: 600;
        font-size: 0.85rem;
        text-decoration: none;
        background: var(--support-bg);
        color: var(--support-text);
        box-shadow: 0 4px 12px var(--support-shadow);
        backdrop-filter: blur(8px);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .support-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 14px var(--support-shadow-hover);
      }
      .theme-switch-wrapper { position: fixed; bottom: 22px; right: 22px; }
      .theme-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
      .theme-switch input { opacity: 0; width: 0; height: 0; }
      .slider {
        position: absolute; inset: 0; cursor: pointer;
        background-color: var(--switch-bg);
        border-radius: 34px;
        transition: var(--transition-time);
        box-shadow: inset 0 2px 6px rgba(0,0,0,.12);
      }
      .slider-icon {
        position: absolute; top: 4px; left: 4px;
        width: 26px; height: 26px; border-radius: 50%;
        background-color: var(--switch-slider);
        box-shadow: 0 3px 6px var(--shadow-color);
        transition: all var(--transition-time) cubic-bezier(.175,.885,.32,1.275);
      }
      .sun-icon, .moon-icon {
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 16px; height: 16px; fill: var(--icon-fill);
        transition: opacity var(--transition-time);
      }
      .sun-icon { opacity: 1; }
      .moon-icon { opacity: 0; }
      input:checked + .slider .slider-icon { transform: translateX(26px); }
      input:checked + .slider .sun-icon { opacity: 0; }
      input:checked + .slider .moon-icon { opacity: 1; }


      /* ====== Animations (変更なし) ====== */
      @keyframes popIn { from {opacity:0; transform:scale(.96)} to {opacity:1; transform:scale(1)} }
      @keyframes slideIn { from {opacity:0; transform:translateY(14px)} to {opacity:1; transform:translateY(0)} }
      @keyframes fadeIn { from {opacity:0} to {opacity:1} }
      @keyframes drawCircle { to { stroke-dashoffset: 0; } }
      @keyframes drawCheck { to { stroke-dashoffset: 0; } }
      @keyframes drawCross { to { stroke-dashoffset: 0; } }

      /* ====== Responsive (変更なし) ====== */
      @media (max-width: 600px) {
        .container { padding: 40px 26px; }
        .page-footer { bottom: 14px; }
        .theme-switch-wrapper { bottom: 14px; right: 14px; }
      }

      @media (prefers-reduced-motion: reduce) {
        * { animation: none !important; transition: none !important; }
      }
    </style>
  </body>
</html>